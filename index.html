<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Asistente de Seguros - Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root {
      --q-blue: #ac31aa;
      --q-blue-2: #0f4fb3;
      --q-orange: #f36f21;
      --bg: #f4f7fb;
      --card: #ffffff;
      --text: #0f172a;
      --muted: #6b7280;
      --border: #e5e7eb;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
    }

    header {
      background: linear-gradient(135deg, var(--q-blue), var(--q-blue-2));
      color: #fff;
      padding: 18px 24px;
      box-shadow: 0 6px 16px rgba(0,0,0,0.15);
    }

    header h2 {
      margin: 0;
      font-weight: 700;
    }

    main {
      max-width: 980px;
      margin: 40px auto;
      padding: 0 16px;
    }

    .card {
      background: var(--card);
      border-radius: 14px;
      padding: 24px;
      box-shadow: 0 10px 22px rgba(0,0,0,0.08);
      border: 1px solid var(--border);
    }

    h1 {
      margin-top: 0;
      color: var(--q-blue);
    }

    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 16px;
      border-bottom: 1px solid var(--border);
    }

    .tab-btn {
      background: none;
      border: none;
      padding: 10px 14px;
      cursor: pointer;
      font-weight: 700;
      color: var(--muted);
      border-bottom: 3px solid transparent;
    }

    .tab-btn.active {
      color: var(--q-blue);
      border-bottom-color: var(--q-orange);
    }

    .tab-content {
      display: none;
      margin-top: 10px;
    }

    .tab-content.active {
      display: block;
    }

    form {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
    }

    label {
      font-size: 13px;
      color: var(--muted);
    }

    input, select {
      width: 100%;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid var(--border);
      font-size: 14px;
    }

    input:focus, select:focus {
      outline: none;
      border-color: var(--q-blue-2);
      box-shadow: 0 0 0 3px rgba(15,79,179,0.12);
    }

    .full {
      grid-column: 1 / -1;
    }

    .actions {
      display: flex;
      justify-content: space-between;
      margin-top: 12px;
    }

    .btn-secondary {
      background: #e5e7eb;
      border: none;
      padding: 10px 16px;
      border-radius: 999px;
      font-weight: 700;
      cursor: pointer;
    }

    .btn-primary {
      background: var(--q-orange);
      color: #fff;
      border: none;
      padding: 10px 16px;
      border-radius: 999px;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 8px 18px rgba(243,111,33,0.35);
    }

    .bot-btn {
      position: fixed;
      bottom: 22px;
      right: 22px;
      background: linear-gradient(135deg, var(--q-blue), var(--q-blue-2));
      color: white;
      padding: 14px 18px;
      border-radius: 999px;
      font-weight: 700;
      border: none;
      cursor: pointer;
      box-shadow: 0 10px 20px rgba(0,0,0,0.25);
      z-index: 9999;
    }

    @media (max-width: 640px) {
      form {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>

<header>
  <h2>Asistente de Seguros Vehiculares</h2>
</header>

<main>
  <div class="card">
    <h1>Registro de informaci√≥n</h1>

    <div class="tabs">
      <button class="tab-btn active" onclick="openTab('vehiculo')">1Ô∏è‚É£ Veh√≠culo</button>
      <button class="tab-btn" onclick="openTab('conductor')">2Ô∏è‚É£ Conductor</button>
    </div>

    <!-- Paso 1 -->
    <div id="vehiculo" class="tab-content active">
      <form id="vehiculoForm">
        <div>
          <label>Placa</label>
          <input id="placa" required />
        </div>
        <div>
          <label>Marca</label>
          <input id="marca" required />
        </div>
        <div>
          <label>Modelo</label>
          <input id="modelo" required />
        </div>
        <div>
          <label>A√±o</label>
          <select id="anio" required></select>
        </div>
        <div class="actions full">
          <span></span>
          <button type="button" class="btn-primary" onclick="openTab('conductor')">
            Siguiente ‚Üí
          </button>
        </div>
      </form>
    </div>

    <!-- Paso 2 -->
    <div id="conductor" class="tab-content">
      <form id="conductorForm">
        <div>
          <label>Nombre completo</label>
          <input id="nombre" required />
        </div>
        <div>
          <label>DNI / Documento</label>
          <input id="dni" required />
        </div>
        <div>
          <label>Tel√©fono</label>
          <input id="telefono" />
        </div>
        <div>
          <label>Email</label>
          <input id="email" type="email" />
        </div>

        <div class="actions full">
          <button type="button" class="btn-secondary" onclick="openTab('vehiculo')">
            ‚Üê Volver
          </button>
          <button type="submit" class="btn-primary">
            Guardar datos
          </button>
        </div>
      </form>
    </div>
  </div>
</main>

<button class="bot-btn" onclick="openBot()">üí¨ Consulta con Amelia</button>

<iframe
  id="receiver"
  src="https://quali.dev.amelia.com/Amelia/ui/QUALI_Dev_UI/3/chat?domain=qualidev&embed=iframe"
  style="position: fixed; bottom: -9999px; right: -9999px; width: 1px; height: 1px; border: 0;"
></iframe>

<script>
  function openTab(tab) {
    document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
    document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));

    document.getElementById(tab).classList.add('active');

    if (tab === 'vehiculo') {
      document.querySelectorAll('.tab-btn')[0].classList.add('active');
    } else {
      document.querySelectorAll('.tab-btn')[1].classList.add('active');
    }
  }

  // A√±os
  const anioSelect = document.getElementById("anio");
  const currentYear = new Date().getFullYear();
  for (let y = currentYear; y >= 1990; y--) {
    const opt = document.createElement("option");
    opt.value = y;
    opt.textContent = y;
    anioSelect.appendChild(opt);
  }

  // Guardar todo
  document.getElementById("conductorForm").addEventListener("submit", function(e) {
    e.preventDefault();

    const data = {
      vehiculo: {
        placa: placa.value,
        marca: marca.value,
        modelo: modelo.value,
        anio: anio.value
      },
      conductor: {
        nombre: nombre.value,
        dni: dni.value,
        telefono: telefono.value,
        email: email.value
      }
    };

    localStorage.setItem("registroSeguro", JSON.stringify(data));
    alert("‚úÖ Datos guardados correctamente");
  });

  // Bot popup
  let botWindow = null;
  function openBot() {
    const width = 380, height = 520;
    const left = window.screenX + window.innerWidth - width - 20;
    const top = window.screenY + window.innerHeight - height - 40;
    const chatUrl = "https://quali.dev.amelia.com/Amelia/ui/QUALI_Dev_UI/3/chat?domain=qualidev&embed=iframe";

    if (botWindow && !botWindow.closed) {
      botWindow.focus();
      return;
    }

    botWindow = window.open(
      chatUrl,
      "ameliaChat",
      `width=${width},height=${height},left=${left},top=${top},resizable=yes,scrollbars=yes`
    );
  }

  function sendToAmelia(data) {
      const iframe = document.getElementById('receiver');

      if (!iframe || !iframe.contentWindow) {
        console.warn("‚ùå Iframe de Amelia no listo");
        return;
      }

      iframe.contentWindow.postMessage(
        data,
        '*'
      );
    }

    window.addEventListener('load', () => {
      console.log("P√°gina cargada, ping a Amelia");
      sendToAmelia({
        actionType: 'ameliaSay',
        actionData: 'Hola Amelia, ya te puedo enviar mensajes desde mi web üôå'
      });
    });

    function goToConductor() {
      openTab('conductor');

      sendToAmelia({
        actionType: 'ameliaConversationAttributes',
        actionData: {
          step: 'conductor',
          completedStep: 'vehiculo'
        }
      });

      sendToAmelia({
        actionType: 'ameliaSay',
        actionData: 'El usuario pas√≥ al paso de conductor.'
      });
    }
</script>

</body>
</html>
